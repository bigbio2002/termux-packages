--- ./usr/include/pwd.h	2025-08-07 08:21:34.382754322 -0400
+++ ./usr/include/pwd.h	2025-07-09 18:03:54.000000000 -0400
@@ -91,6 +91,56 @@
 void setpwent(void) __INTRODUCED_IN(26);
 #endif /* __BIONIC_AVAILABILITY_GUARD(26) */
 
+
+int getpwnam_r(const char* _Nonnull __name, struct passwd* _Nonnull __pwd, char* _Nonnull __buf, size_t __n, struct passwd* _Nullable * _Nonnull __result);
+int getpwuid_r(uid_t __uid, struct passwd* _Nonnull __pwd, char* _Nonnull __buf, size_t __n, struct passwd* _Nullable * _Nonnull __result);
+
+int access(const char* __path, int __mode);
+
+static void android_setup_pwd(struct passwd* pw) {
+       char const* result = "/data/data/com.termux/files/usr/bin/login";
+       if (result == NULL || access(result, /*X_OK*/1) == -1) {
+               pw->pw_shell = "/data/data/com.termux/files/usr/bin/bash";
+       } else {
+               pw->pw_shell = (char*) result;
+       }
+       pw->pw_dir = "/data/data/com.termux/files/home";
+       pw->pw_passwd = "*";
+#ifdef __LP64__
+       pw->pw_gecos = ""; /* Avoid NULL field. */
+#endif
+}
+
+static struct passwd* android_polyfill_getpwuid(uid_t t) {
+       struct passwd* pw = getpwuid(t);
+       if (pw == NULL) return NULL;
+       android_setup_pwd(pw);
+       return pw;
+}
+
+static struct passwd* android_polyfill_getpwnam(const char* name) {
+       struct passwd* pw = getpwnam(name);
+       if (pw == NULL) return NULL;
+       android_setup_pwd(pw);
+       return pw;
+}
+
+static int android_polyfill_getpwuid_r(uid_t uid,
+                                       struct passwd *pwd,
+                                       char *buffer,
+                                       size_t bufsize,
+                                       struct passwd **result) {
+       int ret = getpwuid_r(uid, pwd, buffer, bufsize, result);
+       if (ret != 0) return ret;
+       android_setup_pwd(pwd);
+       return 0;
+}
+
+#define getpwnam android_polyfill_getpwnam
+#define getpwuid android_polyfill_getpwuid
+#define getpwuid_r android_polyfill_getpwuid_r
+static void endpwent(void) { /* Do nothing. */ }
+
 __END_DECLS
 
 #endif
